"use strict";var $api=new API,modalFlash=function(e,t){$("#modal_flash").addClass(t).text(e).show()},save=function(e){var t="/templates",s="The template was created successfully";e!=-1&&(t+="/"+e.toString(),s="The template was updated successfully"),$.post(t,$("#template_form").serialize()).success(function(e){new PNotify({title:"Template Created",text:s,type:"success",styling:"bootstrap3"}),$("#modal_flash").hide(),$("#template_modal").modal("hide")}).error(function(e){modalFlash(e.responseJSON.error,"alert-danger")})},edit=function(e){$("#template_modal").modal("show"),e!=-1&&$api.get_template(e).success(function(e){$("#name").val(e.name),$("#subject").val(e.subject),$("#text").val(e.text)}).error(function(e){modalFlash(e.responseJSON.error,"alert-danger")}),$("#template_form").off("submit"),$("#template_form").submit(function(t){t.preventDefault(),save(e)})},sendTestTemplate=function(e){var t="/templates/send_test";$.post(t,$("#template_form, #recipient_form").serialize()).success(function(e){new PNotify({title:"Email Sent",text:"Test template sent successfully",type:"success",styling:"bootstrap3"}),$("#modal_flash").hide(),$("#template_test_modal").modal("hide")}),e.preventDefault()},deleteTemplate=function(e){swal({title:"Are you sure?",text:"You won't be able to undo this.",type:"warning",showCancelButton:!0,confirmButtonText:"Delete",confirmButtonColor:"#d9534f",reverseButtons:!0,showLoaderOnConfirm:!0,allowOutsideClick:!1,preConfirm:function(){return new Promise(function(t,s){$api.delete_template(e).success(function(e){t()}).error(function(e){s(e.responseJSON.error)})})}}).then(function(){new PNotify({title:"Template Deleted",text:"The template was deleted successfully.",type:"success",styling:"bootstrap3"})})};$(document).ready(function(){location.pathname.split("/").pop();$(".modal").on("hidden.bs.modal",function(){$(this).find("form")[0].reset(),$(this).find("textarea").val("")}),$("#new_template_btn").click(function(){edit(-1)}),$("#send_test_template_btn").click(function(){$("#template_test_modal").modal("show")}),$("#recipient_form").submit(sendTestTemplate),$("#templates-datatable").DataTable({order:[[1,"desc"]],columnDefs:[{render:function(e,t,s){return moment.utc(e).local().format("MMMM Do YYYY, h:mm:ss a")},targets:2}]}),$(document).on("show.bs.modal",".modal",function(){var e=1040+10*$(".modal:visible").length;$(this).css("z-index",e),setTimeout(function(){$(".modal-backdrop").last().not(".modal-stack").css("z-index",e-1).addClass("modal-stack")},0)})});